---
layout: post
title: cmake
data: 2017-10-28 20:05:00 +0800
---

有多个路径的话要给每个路径都创建CMakeLists。

创建工程名称的指令：
`PROJECT(projectname [CXX] [C] [Java])`
工程名之后的语言列表是可以省略的

两个预定义变量：
`PROJECT_BINARY_DIR`和`PROJECT_SOURCE_DIR`
内部编译时这两个变量指向同一个路径
外部编译时不同

定义变量：
`SET(VAR [VALUE])`
VALUE可以有多个值，用空格隔开

MESSAGE指令可向终端输出信息：
`MESSAGE([SEND_ERROR|STATUS|FATAL_ERROR] "message to display")`
SEND_ERROR，会打印错误消息，并跳过生成过程
STATUS，打印带前缀-的消息
FATAL_ERROR，会立即终止

生成一个可执行文件：
`ADD_EXECUTABLE(hello ${SRC_LIST})`
取变量值使用${}

指令都应该大写，参数之间用空格隔开，如果参数中使用了空格，应该用双引号引起来

可以使用`make clean`清理构建结果
但是不能使用`make distclean`命令清理中间文件

外部编译就是在工程下创建一个文件夹
比如新建一个build文件夹，进入build文件夹，执行`cmake ..`就可以
这样就分离了源代码和构建的中间结果

`ADD_SUBDIRECTORY(source_dir [binary_dir] [EXCLUDE_FROM_ALL])`
向当前工程添加存放源代码的子目录，并且可以指定中间二进制和目标二进制文件存放位置，EXCLUDE_FROM_ALL会将该目录排除在编译过程外
`ADD_SUBDIRECTORY(src bin)`就会在构建目录下创建bin目录，相当与将src目录重命名为bin

在定义ADD_EXECUTABLE的文件中定义`SET(EXECUTABLE_OUTPUT_PATH ${PRJECT_BINARY_DIR}/bin)`可以指定生成的二进制文件位置

INSTALL指令来指定安装位置
执行`cmake ..`的时候可以指定-DCMAKE_INSTALL_PREFIX=/sth/sth/sth来设置路径前缀
INSTALL安装指令放在项目的CMakeLists.txt中
