---
layout: post
title: C++
date: 2016-08-11 16:34:00 +0800
---

### 开始
---

IO操作时，输入和输出数据会保存在缓冲区中，可以显示刷新缓冲区，读取`cin`会刷新`cout`，程序异常终止也会刷新`cout`。
`endl`可以结束当前行，并将缓冲区内容刷新到设备中。

```c++
while(std::cin >> value)
```
循环执行过程中，不断检测流的状态，遇到错误或者文件结束符才会结束，Linux中的文件结束符是Ctrl+D。

### 变量和基本类型
---

类型        | 最小宽度
------------|-----------
bool        | 未定义
char        | 8位
wchar_t     | 16位
char16_t    | 16位
char32_t    | 32位
short       | 16位
int         | 16位
long        | 32位
long long   | 64位
float       | 6位有效数字
double      | 10位有效数字
long double | 10位有效数字

`char16_t`和`char32_t`用于Unicode字符集，`wchar_t`可以存放最大的扩展字符集。

类型的选择规则：

- 知道非负，使用无符号类型
- 整数运算用`int`，`short`太短，`long`一般和`int`一样
- 算数表达式不要用`bool`和`char`
- 浮点运算用`duoble`，比`float`精度高速度快

```c++
unsigned char c = -1;
```
`c`的范围是0～255，给他赋了这个范围外的值时，实际值为对256取mod，即`-1 % 256`=255。

无符号数与有符号数相加时，有符号数会转换成无符号数，严禁混用。

八进制数以`0`开头。

数字`-42`的字面值是不包括`-`的，也就是说十进制数字面值不会为负。字面值的类型是可以指定的：

```c++
L'a'    // wchar_t类型
u8"hi!" // utf-8字符串
42ULL   // unsigned lon long类型
1E-3F   // float类型
3.14159L    // long double类型
```
字面值在选择所占空间时，尽量找最小的，存不下再找大的，如后缀有`U`，会在`unsigned int`、`unsigned long`、
`unsigned long long`中选择最小的。

字符串太长可以这样分开书写：

```c++
std::cout << "a"
             "b"
             "c";
```

`nullptr`是指针字面值。

初始化几种形式：

- int a = 0;
- int a(0);
- int a = {0};
- int a{0};

使用大括号的初始化方式由C++11支持，用他初始化内置变量时，如果存在丢失信息风险，就会报错，如用`double`初始化`int`。

默认初始化的值通常由变量类型决定。定义在函数体内部的内置变量不会被初始化，值未定义。尽量给每一个内置类型初始化。

声明与定义是有区别的，声明只是让程序知道存在这个名字，定义会将名字与值关联。仅仅需要声明使用`extern`。

```c++
extern int i;   // 仅声明
int j;  // 声明加定义
```
当需要在多个文件使用同一个变量，只能在一处定义，可以在多处声明。

当局部变量覆盖全局变量时，仍要访问全局变量可以用`::变量名`访问。不过尽量不要与全局变量重名。



```c++
int global = 1;
int main(void) {
    int global = 2;
    std::cout << ::global << global;
    return 0;
}
```

引用类型定义时必须用对象初始化，而且引用的类型要一致，引用会与对象一直绑定在一起。引用只是一个别名，不是对象，所以不能定义引用的引用，
不过可以用引用初始化引用，即都绑定到同一个对象。

```c++
int a = 1;
int &b = a;
int &c = b;
```
`b`和`c`都与`a`绑定，他们的值会同时改变。

引用的定义：

```c++
int a = 1;
int &b = a, c = a, &d = a;
```
`b`和`d`是引用，`c`是`int`。
*引用不能用字面值和表达式初始化，而且引用要与被引用类型完全匹配*

指针与引用不同，他是对象，可以进行赋值和拷贝。指针与指向的变量类型也应该完全匹配。

```c++
int i;
int *p = &i;
```

指针的值有4种：

1. 指向一个对象
2. 指向对象所占空间的下一个位置
3. 空指针
4. 无效指针

定义空指针的方法：

```c++
int *p1 = nullptr;
int *p2 = 0;
int *p3 = NULL;
```
这三种作用相同，尽量使用第一种。

`void*`这种指针可以指向任意对象的地址，但是不能用`*`解引用，只能进行比较，函数输入输出或者赋值给另一个`void*`。

```c++
int i = 4;
int *p;
int *&r = p;    // 从右往左读

r = &i;
*r = 0;
```
`r`是一个引用，引用的是一个指针，指针是`int`指针。

`const`对象必须初始化，可以通过函数的返回值初始化。

```c++
// const.cc
extern const int buf = fcn();
// const .h
extern const int buf;
```
要在多个文件间共享变量，需要在定义前加`extern`。

可以为`const`变量创建引用：

```c++
const int c = 707;
const int &rc = c;
```
可以用`const`和非`const`变量初始化`const`变量，但不能用非`const`变量初始化`const`变量。
